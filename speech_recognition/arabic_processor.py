"""
arabic_processor.py - Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
==================================================
Ù†Ø³Ø®Ø© Ù…ÙˆØ­Ø¯Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ ÙˆÙ…Ø§ ÙƒØ§Ù† Ù…Ø¨Ø¹Ø«Ø±Ù‹Ø§ ÙÙŠ speech_handler.py
Ø§Ù„Ù…Ø·ÙˆØ±: Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†
"""

from enum import Enum
from typing import Tuple, List


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1. Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ù…ÙˆØ­Ø¯ (Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙÙŠÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ…ÙŠÙ†)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

EGYPTIAN_TO_FORMAL = {
    # Ø¹Ø¨Ø§Ø±Ø§Øª Ù…Ø±ÙƒØ¨Ø© Ø£ÙˆÙ„Ø§Ù‹ (Ø§Ù„Ø£Ø·ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø£Ù‚ØµØ± Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø§Ø±Ø¶)
    "Ù…Ø´ Ù‚Ø§Ø¯Ø± Ø£ØªÙ†ÙØ³":       "Ø¶ÙŠÙ‚ ØªÙ†ÙØ³",
    "Ù…Ø´ Ù‚Ø§Ø¯Ø± Ø§ØªÙ†ÙØ³":       "Ø¶ÙŠÙ‚ ØªÙ†ÙØ³",
    "ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªÙ†ÙØ³":     "Ø¶ÙŠÙ‚ ØªÙ†ÙØ³",
    "Ø´Ø§ÙŠÙ Ø¨Ø´ÙƒÙ„ ÙˆØ­Ø´":       "Ø±Ø¤ÙŠØªÙŠ Ø¶Ø¨Ø§Ø¨ÙŠØ©",
    "Ø³Ø§Ù…Ø¹ Ø¨ØµØ¹ÙˆØ¨Ø©":         "Ø¶Ø¹Ù Ø§Ù„Ø³Ù…Ø¹",
    "ÙˆØ¬Ø¹ ØªÙ‚ÙŠÙ„":            "Ø£Ù„Ù… Ø´Ø¯ÙŠØ¯",
    "ÙˆØ¬Ø¹ Ø®ÙÙŠÙ":            "Ø£Ù„Ù… Ø®ÙÙŠÙ",
    "Ù…Ø´ ÙˆØ¬Ø¹ Ø£ÙˆÙŠ":          "Ø£Ù„Ù… Ø®ÙÙŠÙ",
    "Ø£Ù„Ù… Ø´Ø¯ÙŠØ¯ Ø¬Ø¯Ø§Ù‹":       "Ø£Ù„Ù… Ø­Ø§Ø¯",
    "Ù…Ø´ ØªÙ…Ø§Ù…":             "Ù„Ø³Øª Ø¨Ø®ÙŠØ±",
    "Ø¹Ù†Ø¯ÙŠ Ù‚ÙŠØ¡":            "Ø£ØªÙ‚ÙŠØ£",
    "Ù‚Ø¨Ù„ Ø´ÙˆÙŠØ©":            "Ù…Ù†Ø° Ù‚Ù„ÙŠÙ„",
    "Ù…Ù† Ø§Ù…Ø¨Ø§Ø±Ø­":           "Ù…Ù†Ø° Ø£Ù…Ø³",

    # ÙƒÙ„Ù…Ø§Øª Ù…ÙØ±Ø¯Ø©
    "ÙˆØ§Ø¬Ø¹Ù†ÙŠ":   "ÙŠØ¤Ù„Ù…Ù†ÙŠ",
    "ÙˆØ¬Ø¹":      "Ø£Ù„Ù…",
    "ØªØ¹Ø¨Ø§Ù†":    "Ù…Ø±ÙŠØ¶",
    "Ø¯ÙˆØ®Ø©":     "Ø¯ÙˆØ§Ø±",
    "Ø­Ø±Ø§Ø±Ø©":    "Ø­Ù…Ù‰",
    "Ø¶ØºØ·":      "Ø¶ØºØ· Ø§Ù„Ø¯Ù…",
    "Ø³ÙƒØ±":      "Ù…Ø±Ø¶ Ø§Ù„Ø³ÙƒØ±ÙŠ",
    "Ø¯Ù…Ø§ØºÙŠ":    "Ø±Ø£Ø³ÙŠ",
    "ØªÙ†ÙØ³ÙŠ":    "Ø§Ù„ØªÙ†ÙØ³",
    "Ø¨ÙŠÙ„Ù":     "ÙŠØ¯ÙˆØ±",
    "Ù†Ù‡Ø¬Ø§Ù†":    "Ø¶ÙŠÙ‚ ØªÙ†ÙØ³",
    "Ø¨Ù…ÙˆØª":     "Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø©",
    "Ø¨ØªÙ‚ÙŠØ£":    "Ø£ØªÙ‚ÙŠØ£",
    "Ø¹Ù†Ø¯ÙŠ":     "Ù„Ø¯ÙŠ",
    "Ù…Ø­ØªØ§Ø¬":    "Ø£Ø­ØªØ§Ø¬",
    "Ø¹Ø§ÙŠØ²":     "Ø£Ø±ÙŠØ¯",
    "Ù…Ø´ Ø¹Ø§Ø±Ù":  "Ù„Ø§ Ø£Ø¹Ø±Ù",
    "Ø¯Ù„ÙˆÙ‚ØªÙŠ":   "Ø§Ù„Ø¢Ù†",
    "Ø§Ù…Ø¨Ø§Ø±Ø­":   "Ø£Ù…Ø³",
    "Ø®Ø¯":       "Ø£Ø®Ø°",
}


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù†ÙˆØ§ÙŠØ§ (Intents)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

class IntentType(Enum):
    EMERGENCY      = "ğŸš¨ Ø­Ø§Ù„Ø© Ø·Ø§Ø±Ø¦Ø©"
    MEASURE_VITALS = "ğŸ“Š Ù‚ÙŠØ§Ø³ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©"
    NEED_MEDICATION= "ğŸ’Š Ø·Ù„Ø¨ Ø¯ÙˆØ§Ø¡ Ø£Ùˆ Ù…Ø³ÙƒÙ†"
    PAIN_COMPLAINT = "ğŸ˜£ Ø´ÙƒÙˆÙ‰ Ù…Ù† Ø£Ù„Ù…"
    FEELING_BAD    = "ğŸ˜ ØªØ¯Ù‡ÙˆØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©"
    GENERAL_CHAT   = "ğŸ’¬ Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø§Ù…"
    UNKNOWN        = "â“ ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…"

INTENT_KEYWORDS = {
    IntentType.EMERGENCY:       ["Ø¨Ù…ÙˆØª", "Ø¥Ù„Ø­Ù‚ÙˆÙ†ÙŠ", "Ø¬Ù„Ø·Ø©", "Ø¶ÙŠÙ‚ ØªÙ†ÙØ³", "Ø¥ØºÙ…Ø§Ø¡", "Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø©"],
    IntentType.MEASURE_VITALS:  ["Ù‚ÙŠØ³", "Ù†Ø¨Ø¶", "Ø¶ØºØ· Ø§Ù„Ø¯Ù…", "Ø­Ù…Ù‰", "Ø£ÙƒØ³Ø¬ÙŠÙ†", "Ø³ÙƒØ± Ø§Ù„Ø¯Ù…"],
    IntentType.NEED_MEDICATION: ["Ø¯ÙˆØ§Ø¡", "Ø¹Ù„Ø§Ø¬", "Ø¨Ø±Ø´Ø§Ù…", "Ù…Ø³ÙƒÙ†", "Ø£Ø­ØªØ§Ø¬ Ø¯ÙˆØ§Ø¡"],
    IntentType.PAIN_COMPLAINT:  ["Ø£Ù„Ù…", "ÙŠØ¤Ù„Ù…Ù†ÙŠ", "ØµØ¯Ø§Ø¹", "Ø­Ø±Ù‚"],
    IntentType.FEELING_BAD:     ["ØªØ¹Ø¨Ø§Ù†", "Ù…Ø±ÙŠØ¶", "Ù„Ø³Øª Ø¨Ø®ÙŠØ±", "Ø¯ÙˆØ§Ø±"],
}


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3. Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SYMPTOMS_DB = [
    "ØµØ¯Ø§Ø¹", "Ø£Ù„Ù…", "Ø­Ù…Ù‰", "Ø¯ÙˆØ§Ø±", "ÙƒØ­Ø©",
    "Ø¶ÙŠÙ‚ ØªÙ†ÙØ³", "ØªÙ†Ù…ÙŠÙ„", "ØºØ«ÙŠØ§Ù†", "Ù‚ÙŠØ¡",
    "Ø¶Ø¹Ù", "Ø£Ø±Ù‚", "Ø±Ø¤ÙŠØªÙŠ Ø¶Ø¨Ø§Ø¨ÙŠØ©", "Ø¶Ø¹Ù Ø§Ù„Ø³Ù…Ø¹",
    "Ø£Ù„Ù… Ø­Ø§Ø¯", "Ø£Ù„Ù… Ø´Ø¯ÙŠØ¯", "Ø£Ù„Ù… Ø®ÙÙŠÙ",
    "Ø¶ØºØ· Ø§Ù„Ø¯Ù…", "Ù…Ø±Ø¶ Ø§Ù„Ø³ÙƒØ±ÙŠ",
]


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4. Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

class ArabicMedicalProcessor:
    """
    Ù…Ø¹Ø§Ù„Ø¬ Ù…ÙˆØ­Ø¯ ÙŠÙ‚ÙˆÙ… Ø¨Ù€:
    1. ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© â†’ ÙØµØ­Ù‰
    2. ÙƒØ´Ù Ø§Ù„Ù†ÙŠØ© (Intent Detection)
    3. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶
    4. ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©
    """

    def normalize(self, text: str) -> str:
        """ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ø§Ù…ÙŠØ© Ù„ÙØµØ­Ù‰ Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø©"""
        normalized = text
        for dialect, formal in EGYPTIAN_TO_FORMAL.items():
            normalized = normalized.replace(dialect, formal)
        return normalized

    def detect_intent(self, text: str) -> IntentType:
        """ÙƒØ´Ù Ø§Ù„Ù†ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© - Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ø·ÙˆØ§Ø±Ø¦"""
        for intent, keywords in INTENT_KEYWORDS.items():
            if any(word in text for word in keywords):
                return intent
        return IntentType.GENERAL_CHAT

    def extract_symptoms(self, text: str) -> List[str]:
        """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©"""
        return [s for s in SYMPTOMS_DB if s in text]

    def get_urgency(self, intent: IntentType, symptoms: List[str]) -> str:
        """ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©"""
        if intent == IntentType.EMERGENCY or "Ø¶ÙŠÙ‚ ØªÙ†ÙØ³" in symptoms:
            return "ğŸš¨ Ø®Ø·ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹"
        if intent == IntentType.PAIN_COMPLAINT or "Ø£Ù„Ù… Ø­Ø§Ø¯" in symptoms:
            return "âš ï¸ Ù…ØªÙˆØ³Ø·Ø©"
        if symptoms:
            return "âš ï¸ ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø©"
        return "âœ… Ù…Ø³ØªÙ‚Ø±Ø©"

    def process(self, text: str) -> Tuple[str, IntentType, List[str], str]:
        """
        Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - ØªÙØ±Ø¬Ø¹:
        (Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ­Ø¯ØŒ Ø§Ù„Ù†ÙŠØ©ØŒ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ØŒ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©)
        """
        normalized = self.normalize(text.lower())
        intent     = self.detect_intent(normalized)
        symptoms   = self.extract_symptoms(normalized)
        urgency    = self.get_urgency(intent, symptoms)
        return normalized, intent, symptoms, urgency


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ø§Ø®ØªØ¨Ø§Ø±
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if __name__ == "__main__":
    processor = ArabicMedicalProcessor()
    tests = [
        "Ø£Ù†Ø§ Ø¹Ù†Ø¯ÙŠ ÙˆØ¬Ø¹ ÙÙŠ ØµØ¯Ø±ÙŠ Ù…Ù† Ø§Ù…Ø¨Ø§Ø±Ø­",
        "ØªØ¹Ø¨Ø§Ù† ÙˆÙ…Ø´ Ù‚Ø§Ø¯Ø± Ø£ØªÙ†ÙØ³",
        "Ø¹Ù†Ø¯ÙŠ Ø­Ø±Ø§Ø±Ø© ÙˆØµØ¯Ø§Ø¹",
        "Ø¨Ù…ÙˆØª Ø¥Ù„Ø­Ù‚ÙˆÙ†ÙŠ",
        "Ù…Ø­ØªØ§Ø¬ Ø¯ÙˆØ§Ø¡ Ø§Ù„Ø³ÙƒØ±",
    ]
    for text in tests:
        norm, intent, symptoms, urgency = processor.process(text)
        print(f"ğŸ“ Ø§Ù„Ø£ØµÙ„ÙŠ:  {text}")
        print(f"âœ… Ø§Ù„Ù…ÙˆØ­Ø¯:  {norm}")
        print(f"ğŸ¯ Ø§Ù„Ù†ÙŠØ©:   {intent.value}")
        print(f"ğŸ©º Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶: {symptoms}")
        print(f"âš¡ Ø§Ù„Ø­Ø§Ù„Ø©:  {urgency}")
        print("â”€" * 50)